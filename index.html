<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="app_title">NoaDot - 이미지/텍스트 변환기</title>
    <meta http-equiv="Content-Security-Policy" content="
    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.gstatic.com https://cdn.firebase.com https://cdnjs.cloudflare.com; 
    connect-src 'self' wss://*.firebaseio.com https://*.firebaseio.com https://*.googleapis.com https://www.gstatic.com https://cdnjs.cloudflare.com;">
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC8o-GgPjhBepBUs3HF3cD7XMXP9-haUgI",
            authDomain: "noadot-commet-system.firebaseapp.com",
            projectId: "noadot-commet-system",
            storageBucket: "noadot-commet-system.firebasestorage.app",
            messagingSenderId: "335432879892",
            appId: "1:335432879892:web:62197c9dfef7a4bfd17c01"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = app.firestore();
        const COMMENTS_COLLECTION = "noadot_comments";

    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>

<div class="app-container">
    <!-- 왼쪽 패널 -->
    <div class="left-panel">
        <header class="main-header">
            <h1 data-lang-key="app_header">🎨 NoaDot v6.2</h1>
            <div class="external-links">
                
                <!-- 2. GeoPixels (이미지 아이콘) -->
                <a href="https://www.geopixels.net/" target="_blank" title="GeoPixels">
                    <img src="geopixels-logo.png" alt="GeoPixels Logo">
                </a>

                <!-- 3. Wplace (이미지 아이콘) -->
                <a href="https://wplace.live/" target="_blank" title="Wplace">
                    <img src="wplace-logo.png" alt="Wplace Logo">
                </a>
                <a href="https://github.com/noadot-pixel/noadot-pixel.github.io" target="_blank" title="GitHub">
                    <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub">
                </a>
                <a href="https://noipung.github.io/wdot/" target="_blank" title="Wdot Color Engine" class="text-icon-link">
                    <span class="wdot-icon">W</span>
                </a>
                <div class="link-separator"></div>
                <div id="language-switcher" class="language-switcher">
                    <button data-lang="ko" class="active">KR</button>
                    <button data-lang="en">EN</button>
                </div>
            </div>
        </header>

        <div class="left-panel-content">
            <div id="text-editor-panel" style="display: none;">
                <div class="editor-toolbar">
                    <button class="style-btn" data-style="bold" title="굵게" data-lang-key="text_bold" data-tooltip-key="tooltip_bold"><b>B</b></button>
                    <button class="style-btn" data-style="italic" title="기울임" data-lang-key="text_italic" data-tooltip-key="tooltip_italic"><i>I</i></button>
                </div>
                <textarea id="editor-textarea" data-lang-placeholder="placeholder_text_editor" placeholder="여기에 텍스트를 입력하세요..."></textarea>
            </div>
            
            <section id="result-area">
                <div id="convertedCanvasContainer">
                    <div id="top-ui-container">
                        <div id="metadata-info-display"></div>
                        <div class="top-right-ui">
                            <div id="zoomLevelDisplay">100%</div>
                            <div id="loading-indicator"></div>
                            <button id="compareBtn" class="compare-icon-btn" title="원본 비교 (누르고 있기)" data-tooltip-key="tooltip_compare_hold">
                                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                    <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div id="placeholder-ui">
                        <svg class="upload-icon" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/></svg>
                        <p data-lang-key="placeholder_image_upload">창 클릭 혹은 이미지를 화면으로 드래그</p>
                    </div>
                    
                    <canvas id="convertedCanvas"></canvas>
                    <button id="centerBtn" title="화면 중앙 및 확대/축소 초기화" data-tooltip-key="tooltip_center_zoom">✜</button>
                </div>
            </section>
        </div>
    </div>

    <!-- 오른쪽 패널 -->
    <div class="right-panel">
        <section class="main-mode-switcher">
            <h2 data-lang-key="section_mode">1. 모드 선택</h2>
            <div class="radio-toggle main-toggle">
                <input type="radio" id="imageMode" name="appMode" value="image" checked>
                <label for="imageMode" data-lang-key="mode_image">🖼️ 이미지</label>
                <input type="radio" id="textMode" name="appMode" value="text">
                <label for="textMode" data-lang-key="mode_text">✏️ 텍스트</label>
            </div>
        </section>

        <div id="image-controls">
            <input type="file" id="imageUpload" accept="image/png, image/jpeg, image/gif" hidden>
            <div id="imageInfoPanel" class="image-info-group" style="display: none; background: rgba(255,255,255,0.5); padding: 10px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #ddd;">
                
                <div style="font-size: 13px; color: #555; margin-bottom: 4px;">
                    <span data-lang-key="info_original_size">원본 크기</span>: 
                    <strong id="originalDimensions">0 x 0 px</strong>
                </div>

                <div style="font-size: 14px; margin-bottom: 4px;">
                    <span data-lang-key="info_converted_size">변환 크기</span>: 
                    <strong id="convertedDimensions" style="font-weight: 900; color: #333;">0 x 0 px</strong>
                </div>

                <div style="font-size: 12px; color: #666;">
                    <span data-lang-key="info_total_pixels">총 픽셀 수</span>: 
                    <strong id="totalPixelCount" style="font-weight: 900; color: #333; font-size: 13px;">0</strong>
                </div>

            </div>
            <section>
                <h2 data-lang-key="section_resize">2. 크기 조절</h2>
                <fieldset id="scaleControlsFieldset" disabled>
                    <div class="control-group">
                        <label for="scaleModeSelect" data-lang-key="resize_mode" data-tooltip-key="tooltip_resize_mode">조절 방식</label>
                        <select id="scaleModeSelect">
                            <option value="pixel" data-lang-key="resize_pixel">픽셀 단위</option>
                            <option value="ratio" data-lang-key="resize_ratio">비율 단위</option>
                        </select>
                    </div>
                    <div id="ratio-scale-controls" class="hidden">
                        <div class="control-group">
                            <label for="scaleSlider"><span data-lang-key="resize_scale_ratio">축소 배율</span>: <span id="scaleValue">1.00x</span></label>
                            <input type="range" id="scaleSlider" min="0" max="76" value="0" step="1">
                        </div>
                    </div>
                    <div id="pixel-scale-controls">
                         <div class="control-group">
                            <label for="pixelScaleSlider" data-lang-key="resize_pixel_amount" data-tooltip-key="tooltip_pixel_scale">픽셀 축소량</label>
                            <input type="range" id="pixelScaleSlider" min="0" value="0">
                        </div>
                        <div class="control-group scale-control-group">
                            <div class="scale-input-wrapper">
                                <span class="scale-label" data-lang-key="resize_width">너비</span><input type="number" id="scaleWidth" min="1">
                                <div class="scale-buttons"><button class="scale-mod-btn" data-target="scaleWidth" data-amount="-1">-</button><button class="scale-mod-btn" data-target="scaleWidth" data-amount="1">+</button></div>
                            </div>
                            <div class="scale-input-wrapper">
                                <span class="scale-label" data-lang-key="resize_height">높이</span><input type="number" id="scaleHeight" min="1">
                                <div class="scale-buttons"><button class="scale-mod-btn" data-target="scaleHeight" data-amount="-1">-</button><button class="scale-mod-btn" data-target="scaleHeight" data-amount="1">+</button></div>
                            </div>
                        </div>
                    </div>
                    <div class="control-group" style="border-top: 1px dashed #ccc; padding-top: 15px; margin-top: 15px;">
                        <label for="exportScaleSlider" data-tooltip-key="tooltip_export_scale">
                            <span data-lang-key="resize_output_scale">출력 배율</span>: 
                            <span id="exportScaleValue">1x</span>
                            <span data-lang-key="size_change_download" style="font-size:12px; font-weight:normal; color:#666; margin-left:5px;">(다운로드 시 적용)</span>
                        </label>
                        <input type="range" id="exportScaleSlider" min="1" max="10" value="1" step="1">
                        <section class="option-section">
                            <h2 data-lang-key="section_upscale" data-tooltip-key="tooltip_upscale_options">업스케일</h2>
                            <div class="radio-toggle" id="upscale-control-group" data-tooltip-key="tooltip_upscale_options">
                                <!-- 1배 -->
                                <input type="radio" id="upscale1x" name="upscaleMode" value="1" checked>
                                <label for="upscale1x" data-lang-key="upscale_1x">1x (기본)</label>

                                <!-- 2배 -->
                                <input type="radio" id="upscale2x" name="upscaleMode" value="2">
                                <label for="upscale2x" data-lang-key="upscale_2x">2x (EPX)</label>

                                <!-- 3배 -->
                                <input type="radio" id="upscale3x" name="upscaleMode" value="3">
                                <label for="upscale3x" data-lang-key="upscale_3x">3x (EPX)</label>
                            </div>
                        </section>
                    </div>
                </fieldset>
            </section>
        </div>

        <section id="ai-preset-section" class="option-section">
            <h2 data-lang-key="section_ai_preset">✨ 프리셋 추천</h2>

            <!-- 1. 메인 버튼 (맨 위로 이동) -->
            <button id="getStyleRecommendationsBtn" class="analyze-button main-big-btn" disabled>
                <span style="font-size: 1.5em;" data-lang-key="preset_recommended">프리셋 추천</span>
            </button>

            <!-- 2. 서브 버튼 그룹 (아래로 이동) -->
            <div class="preset-sub-button-group">
                <!-- 저장 버튼 -->
                <button id="savePresetBtn" data-lang-key="preset_save" class="sub-preset-btn" style="background-color: #17a2b8;">
                    현재 설정<br>저장하기
                </button>
                
                <!-- 불러오기 버튼 -->
                <button id="loadPresetBtn" data-lang-key="preset_load" class="sub-preset-btn" style="background-color: #6c757d;">
                    프리셋<br>불러오기
                </button>
                
                <!-- 보관함 버튼 -->
                <button id="myPresetsBtn" data-lang-key="preset_storage" class="sub-preset-btn" style="background-color: #fd7e14;">
                    프리셋<br>보관함
                </button>
            </div>
            
            <!-- 숨겨진 파일 업로드 (기존 유지) -->
            <input type="file" id="presetUpload" accept=".json" hidden>
        </section>
        <section id="ai-preset-section" class="option-section">
            <div id="preset-recommendation-list" class="preset-list-container"></div>

            <input type="file" id="presetUpload" accept=".json" hidden>
        </section>

        <!-- 텍스트 모드 컨트롤 -->
        <div id="text-controls" style="display: none;">
            <section>
                <h2 data-lang-key="section_text_style">2. 텍스트 스타일</h2>
                <div class="control-group font-controls">
                    <select id="fontSelect">
                        <option value="Malgun Gothic">맑은 고딕</option> <option value="Gulim">굴림</option> <option value="Dotum">돋움</option> <option value="Arial">Arial</option> <option value="Verdana">Verdana</option>
                    </select>
                    <button id="uploadFontBtn" title="폰트 파일 업로드" data-lang-key="text_upload_font">폰트+</button>
                    <input type="file" id="fontUpload" accept=".ttf, .otf, .woff, .woff2" hidden>
                </div>
                 <div class="control-group">
                    <label for="fontSizeSlider"><span data-lang-key="text_font_size">글자 크기</span>: <span id="fontSizeValue">15</span>px</label>
                    <input type="range" id="fontSizeSlider" min="8" max="100" value="15">
                </div>
                <div class="control-group">
                    <label for="letterSpacingSlider"><span data-lang-key="text_letter_spacing">자간</span>: <span id="letterSpacingValue">0</span>px</label>
                    <input type="range" id="letterSpacingSlider" min="-5" max="20" value="0">
                <div class="control-group">
                    <label for="textLineHeightSlider"><span data-lang-key="text_line_height">줄 간격</span>: <span id="textLineHeightValue">1.5</span>x</label>
                    <input type="range" id="textLineHeightSlider" min="10" max="30" value="15" step="1">
                </div>
                </div>
                <div class="control-group">
                    <label for="paddingSlider"><span data-lang-key="text_padding">여백</span>: <span id="paddingValue">10</span>px</label>
                    <input type="range" id="paddingSlider" min="0" max="50" value="10">
                </div>
                 <div class="control-group">
                    <label for="strokeWidthSlider"><span data-lang-key="text_stroke_width">테두리 두께</span>: <span id="strokeWidthValue">0</span>px</label>
                    <input type="range" id="strokeWidthSlider" min="0" max="10" value="0">
                </div>
                <div class="control-group color-picker-group">
                    <label for="textColorSelect" data-lang-key="text_color">글자색</label><select id="textColorSelect"></select>
                </div>
                 <div class="control-group color-picker-group">
                    <label for="strokeColorSelect" data-lang-key="text_stroke_color">테두리색</label><select id="strokeColorSelect"></select>
                </div>
                <div class="control-group color-picker-group">
                    <label for="bgColorSelect" data-lang-key="text_bg_color">배경색</label><select id="bgColorSelect"></select>
                </div>         
            </section>
        </div>

        <section class="option-section">
            <h2 data-lang-key="section_options">3. 변환 옵션</h2>
            <div class="control-group">
                <label for="saturationSlider"><span data-lang-key="option_saturation">채도</span>: <span id="saturationValue">100</span><button class="reset-btn" data-target="saturationSlider" title="초기화">⟳</button></label>
                <input type="range" id="saturationSlider" min="0" max="200" value="100">
            </div>
            <div class="control-group">
                <label for="brightnessSlider"><span data-lang-key="option_brightness">밝기</span>: <span id="brightnessValue">0</span><button class="reset-btn" data-target="brightnessSlider" title="초기화">⟳</button></label>
                <input type="range" id="brightnessSlider" min="-100" max="100" value="0">
            </div>
            <div class="control-group">
                <label for="contrastSlider"><span data-lang-key="option_contrast">대비</span>: <span id="contrastValue">0</span><button class="reset-btn" data-target="contrastSlider" title="초기화">⟳</button></label>
                <input type="range" id="contrastSlider" min="-100" max="100" value="0">
            </div>
            
            <div id="dithering-algorithm-group" class="control-group">
                <label for="ditheringAlgorithmSelect" data-lang-key="option_dithering" data-tooltip-key="tooltip_dithering">디더링</label>
                <select id="ditheringAlgorithmSelect">
                    <option value="floyd" data-lang-key="dithering_floyd">플로이드-스타인버그</option>
                    <option value="sierra" data-lang-key="dithering_sierra">시에라-2</option>
                    <option value="atkinson" selected data-lang-key="dithering_atkinson">애킨슨</option>
                    <option value="none" data-lang-key="dithering_none">사용 안함</option>
                </select>
            </div>
            <div id="dithering-strength-group" class="control-group">
                <label for="ditheringSlider"><span data-lang-key="option_dithering_strength">디더링 강도</span>: <span id="ditheringValue">0</span>%<button class="reset-btn" data-target="ditheringSlider" title="초기화">⟳</button></label>
                <input type="range" id="ditheringSlider" min="0" max="100" value="0">
            </div>

            <div class="control-group"  style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px;">
                <label for="colorMethodSelect" data-lang-key="option_color_method" data-tooltip-key="tooltip_color_method">색상 계산 방식</label>
                <select id="colorMethodSelect" data-tooltip-key="tooltip_color_method">
                    <option value="rgb" data-lang-key="option_color_method_rgb">RGB - 단순 변환</option>
                    <option value="oklab" selected data-lang-key="option_color_method_oklab">OKlab - 색상 보정 변환</option>
                    <!-- [New] Wdot 옵션 추가 -->
                    <option value="ciede2000" data-lang-key="option_color_method_ciede2000">Wdot - 고품질 변환(웜톤)</option>
                    <option value="ciede2000-d65" data-lang-key="option_color_method_D65">D65 - 고품질 변환(쿨톤)</option>
                </select>
            </div>

            <div class="control-group checkbox-group" style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px;">
                <input type="checkbox" id="chkSharpResizing" checked>
                <label for="chkSharpResizing" data-lang-key="label_sharp_resizing">선명한 리사이징 (픽셀 보정)</label>
            </div>

            <div class="control-group checkbox-group" style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px;">
                <input type="checkbox" id="applyPattern">
                <label for="applyPattern" data-lang-key="option_apply_pattern" data-tooltip-key="tooltip_cartoon_filter">패턴 적용</label>
            </div>
            <div id="patternOptions" class="sub-options" style="display: none; padding-left: 5px; padding-bottom: 10px;">
                <div class="control-group">
                    <label for="patternTypeSelect" data-lang-key="pattern_type">패턴 종류</label>
                    <select id="patternTypeSelect">
                        <option value="bayer8x8" data-lang-key="pattern_bayer">점묘화 (베이어 8x8)</option>
                        <option value="crosshatch" data-lang-key="pattern_crosshatch">격자</option>
                        <option value="vertical" data-lang-key="pattern_vertical">수직선</option>
                        <option value="checkerboard" data-lang-key="pattern_checkerboard">체커보드</option>
                        <option value="diagonal_right" data-lang-key="pattern_diagonal_right">대각선 (↘)</option>
                        <option value="diagonal_left" data-lang-key="pattern_diagonal_left">대각선 (↙)</option>
                        <option value="brick" data-lang-key="pattern_brick">벽돌</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="patternSizeSlider"><span data-lang-key="pattern_size">패턴 크기</span>: <span id="patternSizeValue">4</span></label>
                    <input type="range" id="patternSizeSlider" min="2" max="32" value="4">
                </div>
            </div>

            <div class="control-group checkbox-group" style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px;">
                <input type="checkbox" id="applyGradient">
                <label for="applyGradient" data-lang-key="option_apply_gradient" data-tooltip-key="tooltip_gradient">투명도 그라데이션 적용</label>
            </div>
            <div id="gradientOptions" class="sub-options" style="display: none; padding-left: 5px; padding-bottom: 10px;">
                <div class="control-group">
                    <label for="gradientTypeSelect" data-lang-key="gradient_type">스타일</label>
                    <select id="gradientTypeSelect">
                        <option value="bayer" selected>패턴 (Bayer)</option>
                        <option value="floyd">부드럽게 (Floyd)</option>
                        <option value="sierra">시에라 (Sierra)</option>
                        <option value="atkinson">거칠게 (Atkinson)</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="gradientDitherSizeSlider"><span data-lang-key="gradient_dither_size">입자 크기</span>: <span id="gradientDitherSizeValue">1</span>px</label>
                    <input type="range" id="gradientDitherSizeSlider" min="1" max="16" value="1">
                </div>
                <div class="control-group">
                    <label for="gradientAngleSlider"><span data-lang-key="gradient_angle">각도</span>: <span id="gradientAngleValue">0</span>°</label>
                    <input type="range" id="gradientAngleSlider" min="0" max="360" value="0">
                </div>
                <div class="control-group">
                    <label for="gradientStrengthSlider"><span data-lang-key="gradient_strength">강도</span>: <span id="gradientStrengthValue">100</span>%</label>
                    <input type="range" id="gradientStrengthSlider" min="0" max="100" value="100">
                </div>
            </div>

            <div class="control-group checkbox-group" style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px;">
                <input type="checkbox" id="applyAspireDither">
                <label for="applyAspireDither" data-lang-key="option_apply_aspire">Aspire 스타일</label>
            </div>

            <div class="control-group checkbox-group" style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px;">
                <input type="checkbox" id="applyRefinement">
                <label for="applyRefinement" data-lang-key="option_apply_refinement">면 평탄화</label>
            </div>
            <div id="refinementOptions" class="sub-options" style="display: none; padding-left: 5px; padding-bottom: 10px;">
                <div class="control-group">
                    <label for="refinementSlider" data-lang-key="label_refinement_strength">강도: <span id="refinementValue">50</span></label>
                    <input type="range" id="refinementSlider" min="1" max="100" value="50" step="1">
                </div>
            </div>

            <div class="control-group checkbox-group" style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px; margin-bottom: 10px;">
                <input type="checkbox" id="celShadingApply">
                <label for="celShadingApply" data-lang-key="option_cartoon_filter">만화 스타일 필터 (Cel Shading)</label>
            </div>
            <div id="celShadingOptions" class="sub-options" style="display: none; padding-left: 5px;">
                <fieldset class="sub-fieldset" style="margin-bottom: 10px;">
                    <legend data-lang-key="cartoon_section_quant">색상 추출 (Quantization)</legend>
                    <div class="control-group">
                        <label for="celShadingAlgorithmSelect" data-lang-key="cartoon_algorithm">알고리즘</label>
                        <select id="celShadingAlgorithmSelect">
                            <option value="kmeans" selected data-lang-key="option_kmeans">K-Means (기본 - 균형잡힘)</option>
                            <option value="wu" data-lang-key="option_wu">Wu's Algorithm (최고 품질 - 추천)</option>
                            <option value="mediancut" data-lang-key="option_mediancut">Median Cut (대중적)</option>
                            <option value="octree" data-lang-key="option_octree">Octree (빠름)</option>
                            <option value="popularity" data-lang-key="option_popularity">Popularity (빈도수 - 단순함)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="celShadingLevelsSlider"><span data-lang-key="cartoon_color_level">색상 레벨</span>: <span id="celShadingLevelsValue">8</span></label>
                        <input type="range" id="celShadingLevelsSlider" min="2" max="32" value="8">
                    </div>
                    <div class="control-group">
                        <label for="celShadingColorSpaceSelect" data-lang-key="cartoon_quant_space">색 공간</label>
                        <select id="celShadingColorSpaceSelect">
                            <option value="oklab" data-lang-key="space_oklab">고품질 (OKLab)</option>
                            <option value="rgb" data-lang-key="space_rgb">일반 (RGB)</option>
                        </select>
                    </div>
                    <div class="control-group" style="justify-content: flex-end; margin-top: 5px;">
                        <button id="celShadingRetryBtn" class="analyze-button" 
                            data-lang-key="btn_retry_color_combination" 
                            data-tooltip-key="tooltip_retry_seed"
                            style="width: 100%;">
                            🎲 다른 색상 조합 시도
                        </button>
                    </div>
                </fieldset>

                <fieldset class="sub-fieldset">
                    <legend data-lang-key="cartoon_section_outline">외곽선 (Outline)</legend>
                    <div class="control-group checkbox-group" style="padding-left: 0; margin-bottom: 0;">
                        <input type="checkbox" id="celShadingOutline">
                        <label for="celShadingOutline" data-lang-key="cartoon_show_outline">외곽선 표시</label>
                    </div>
                    <div id="celShadingOutlineOptions" style="display: none; margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px;">
                        <div class="control-group">
                            <label for="celShadingOutlineThresholdSlider"><span data-lang-key="cartoon_outline_threshold">외곽선 민감도</span>: <span id="celShadingOutlineThresholdValue">50</span></label>
                            <input type="range" id="celShadingOutlineThresholdSlider" min="10" max="150" value="50">
                        </div>
                        <div class="control-group color-picker-group">
                            <label for="celShadingOutlineColorSelect" data-lang-key="cartoon_outline_color">외곽선 색상</label>
                            <select id="celShadingOutlineColorSelect">
                            </select>
                        </div>
                    </div>
                </fieldset>
            </div>
        </section>

        <section class="mode-switcher">
            <h2 data-lang-key="section_palette">4. 팔레트 선택</h2>
            <div class="radio-toggle">
                <input type="radio" id="geopixelsMode" name="paletteMode" value="geopixels" checked>
                <label for="geopixelsMode">GeoPixels</label>
                
                <input type="radio" id="wplaceMode" name="paletteMode" value="wplace">
                <label for="wplaceMode">Wplace</label>

                <input type="radio" id="uplaceMode" name="paletteMode" value="uplace">
                <label for="uplaceMode">youplace</label>
            </div>
        </section>

        <div class="palette-collection">
            <div id="geopixels-controls">
                <details open class="palette-category"><summary><span class="palette-status-icon" data-target="geoPixelColors"></span><span data-lang-key="palette_geopixels_default">GeoPixels 기본 팔레트</span></summary><div class="palette-section"><div class="palette-buttons" id="geoPixelColors"></div></div></details>
                <details class="palette-category"><summary><span class="palette-status-icon" data-target="wplaceFreeColorsInGeo,wplacePaidColorsInGeo"></span><span data-lang-key="palette_use_wplace">Wplace 팔레트 사용하기</span></summary><div class="palette-section"><div class="control-group checkbox-group"><input type="checkbox" id="useWplaceInGeoMode"><label for="useWplaceInGeoMode" data-lang-key="palette_use_wplace_in_geo">GeoPixels 모드에서 Wplace 팔레트 함께 사용</label></div><div id="wplace-palette-in-geo" style="display: none;"><h4 data-lang-key="palette_wplace_free">Wplace 무료</h4><div class="palette-buttons" id="wplaceFreeColorsInGeo"></div><h4 style="margin-top:15px;" data-lang-key="palette_wplace_paid">Wplace 유료</h4><div class="palette-buttons" id="wplacePaidColorsInGeo"></div></div></div></details>
            </div>
            
            <div id="wplace-controls" style="display: none;">
                <details open class="palette-category"><summary><span class="palette-status-icon" data-target="wplaceFreeColors"></span><span data-lang-key="palette_wplace_free">Wplace 무료 팔레트</span></summary><div class="palette-section"><div class="palette-buttons" id="wplaceFreeColors"></div></div></details>
                <details class="palette-category"><summary><span class="palette-status-icon" data-target="wplacePaidColors"></span><span data-lang-key="palette_wplace_paid">Wplace 유료 팔레트</span></summary><div class="palette-section"><div class="palette-buttons" id="wplacePaidColors"></div></div></details>
            </div>

            <div id="uplace-controls" style="display: none;">
                <details open class="palette-category">
                    <summary><span class="palette-status-icon" data-target="uplaceColorsList"></span><span data-lang-key="palette_uplace_default">Uplace 팔레트</span></summary>
                    <div class="palette-section"><div class="palette-buttons" id="uplaceColorsList"></div></div>
                </details>
            </div>
        </div>

        <details open class="palette-category user-palette" id="user-palette-section">
            <summary><span class="palette-status-icon" data-target="addedColors"></span><span data-lang-key="palette_user">사용자 팔레트</span></summary>
            
            <div id="recommendation-section" class="palette-section">
                <h2 data-lang-key="section_color_extract">색상 추출 추천</h2>
                    
                <div id="recommendation-report-container" class="recommendation-report-area" style="display: none;"></div>
                
                <div id="recommendedColorsPlaceholder" class="placeholder-section" style="margin-top: 15px;" data-lang-key="placeholder_recommend">이미지를 업로드하면<br>추천 색상이 표시됩니다.</div>
            </div>

            <div id="user-defined-palette" class="palette-section">
                <h2 data-lang-key="palette_added_colors">추가한 색상</h2>
                <div class="sort-control-wrapper" style="display: flex; align-items: center; gap: 5px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                    </svg>
                    <select id="paletteSortSelect" style="border: none; background: transparent; font-size: 12px; color: #555; cursor: pointer; outline: none; font-weight: bold;">
                        <optgroup data-lang-label="sort_group_default" label="기본">
                            <option value="default" data-lang-key="sort_option_default">등록 순서</option>
                        </optgroup>
                        <optgroup data-lang-label="sort_group_usage" label="사용량">
                            <option value="usage_desc" data-lang-key="sort_option_usage_desc">많은 순 (▼)</option>
                            <option value="usage_asc" data-lang-key="sort_option_usage_asc">적은 순 (▲)</option>
                        </optgroup>
                        <optgroup data-lang-label="sort_group_brightness" label="밝기">
                            <option value="bright_desc" data-lang-key="sort_option_bright_desc">밝은 순 (White▼)</option>
                            <option value="bright_asc" data-lang-key="sort_option_bright_asc">어두운 순 (Black▲)</option>
                        </optgroup>
                        <optgroup data-lang-label="sort_group_rgb" label="RGB 값">
                            <option value="r_desc" data-lang-key="sort_option_r_desc">Red 높은 순</option>
                            <option value="g_desc" data-lang-key="sort_option_g_desc">Green 높은 순</option>
                            <option value="b_desc" data-lang-key="sort_option_b_desc">Blue 높은 순</option>
                        </optgroup>
                    </select>
                </div>
                <div class="palette-buttons" id="addedColors">
                     <div class="placeholder-section" data-lang-key="placeholder_add_color">아래에서 직접 색상을 추가하세요.</div>
                </div>
                <form class="add-color-form" onsubmit="return false;">
                    <div class="add-color-input-group"><input type="text" id="addHex" data-lang-placeholder="placeholder_hex" placeholder="HEX 코드 입력 (예: #FF595E)"></div>
                    <span id="hexInputFeedback" class="input-feedback">&nbsp;</span>
                    <div class="add-color-separator" data-lang-key="palette_or">또는</div>
                    <div class="add-color-input-group"><input type="number" id="addR" min="0" max="255" placeholder="R"><input type="number" id="addG" min="0" max="255" placeholder="G"><input type="number" id="addB" min="0" max="255" placeholder="B"></div>
                    <span id="rgbInputFeedback" class="input-feedback">&nbsp;</span>
                    <button id="addColorBtn" data-lang-key="btn_add">추가</button>
                </form>
                <button id="resetAddedColorsBtn" class="reset-all-colors-btn" data-lang-key="btn_reset_added_colors">추가한 색상 전체 초기화</button>
            </div>
             <div class="palette-section">
                <h2 data-lang-key="section_palette_io">팔레트 가져오기/내보내기</h2>
                <div class="color-code-section">
                    <p style="font-size:14px; color:#555; margin:0 0 10px 0;" data-lang-key="info_palette_io">현재 '추가한 색상' 목록을 파일로 저장하거나, 파일에서 불러옵니다.</p>
                    <div class="button-group-horizontal">
                        <button id="exportPaletteBtn" data-lang-key="btn_export_palette">파일로 내보내기</button>
                        <button id="importPaletteBtn" data-lang-key="btn_import_palette">파일에서 불러오기</button>
                    </div>
                    <input type="file" id="paletteUpload" accept=".json, .txt" hidden>
                </div>
            </div>
        </details>

        <section class="download-section">
            <div id="preset-save-choice-modal" class="hidden modal-overlay">
                <div class="modal-content">
                    <h3 data-lang-key="modal_preset_save_title">프리셋을 어떻게 저장하시겠습니까?</h3>
                    <p style="color:#666; font-size:14px; margin-bottom:20px;" data-lang-key="modal_preset_save_desc">현재 적용된 모든 옵션과 추가된 색상이 저장됩니다.</p>
                    <div class="modal-buttons-vertical">
                        <button id="btn-save-to-file" data-lang-key="btn_save_file">📂 파일로 저장하기 (.json)</button>
                        <button id="btn-save-to-session" data-lang-key="btn_save_session">✨ 스타일 프리셋 목록</button>
                        <button id="btn-close-save-modal" class="secondary-btn" data-lang-key="btn_close">닫기</button>
                    </div>
                </div>
            </div>

            <!-- 4. [신규] 프리셋 이름 입력 팝업 (Modal 2) -->
            <div id="preset-name-input-modal" class="hidden modal-overlay">
                <div class="modal-content">
                    <!-- 제목 -->
                    <h3 data-lang-key="modal_name_title">프리셋 이름 지정</h3>
                    
                    <!-- 설명 -->
                    <p style="color:#666; font-size:14px; margin-bottom:15px;" data-lang-key="modal_name_desc">
                        저장할 프리셋의 이름을 입력해주세요.
                    </p>
                    
                    <!-- 입력창 (placeholder는 data-lang-placeholder 사용) -->
                    <input type="text" id="preset-name-input" 
                        placeholder="예: 나만의 흑백 스타일" 
                        data-lang-placeholder="placeholder_preset_name" 
                        class="full-width-input">
                    
                    <div class="modal-buttons-horizontal" style="margin-top: 20px;">
                        <!-- 저장 버튼 -->
                        <button id="btn-confirm-save-file" data-lang-key="btn_confirm_save">저장하기</button>
                        
                        <!-- 취소 버튼 -->
                        <button id="btn-cancel-save-file" class="secondary-btn" data-lang-key="btn_cancel">취소</button>
                    </div>
                </div>
            </div>
            <button id="downloadBtn" disabled data-lang-key="btn_download">다운로드</button>
            <div id="download-options-container" style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee;">
                
                <div class="custom-checkbox-wrapper">
                    <input type="checkbox" id="chkDownloadSeparated" class="custom-checkbox-input">
                    <label for="chkDownloadSeparated" class="custom-checkbox-label">
                        <span class="checkmark"></span>
                        <span data-lang-key="label_download_separated">색상별 이미지 별도 다운로드 (.zip)</span>
                    </label>
                </div>

                <div class="custom-checkbox-wrapper">
                    <input type="checkbox" id="chkDownloadSplit" class="custom-checkbox-input">
                    <label for="chkDownloadSplit" class="custom-checkbox-label">
                        <span class="checkmark"></span>
                        <span data-lang-key="label_download_split">도안 분할 다운로드 (.zip)</span>
                    </label>
                </div>

                <div id="split-options" style="display: none; padding-left: 28px; margin-top: 10px; border-left: 2px solid #ddd;">
                    <div class="control-group" style="margin-bottom: 8px;">
                        <label style="font-size: 12px; color: #666; display: block; margin-bottom: 4px;" data-lang-key="label_split_count">분할 수 (가로 x 세로)</label>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <input type="number" id="splitCols" value="2" min="1" style="width: 50px; padding: 2px; border: 1px solid #ccc; border-radius: 4px;">
                            <span style="font-size: 12px;">x</span>
                            <input type="number" id="splitRows" value="2" min="1" style="width: 50px; padding: 2px; border: 1px solid #ccc; border-radius: 4px;">
                        </div>
                    </div>
                    <div class="custom-checkbox-wrapper">
                        <input type="checkbox" id="chkMaintainSize" class="custom-checkbox-input">
                        <label for="chkMaintainSize" class="custom-checkbox-label" style="font-size: 12px;">
                            <span class="checkmark"></span>
                            <span data-lang-key="label_maintain_size">원본 사이즈 유지하기 (여백 투명화)</span>
                        </label>
                    </div>
                </div>

            </div>
        </section>
        <section id="comment-entry-section" style="text-align: center; margin: 20px 0;">
            <button id="open-comment-modal" data-lang-key="COMMENT_MODAL_OPEN_BUTTON" class="comment-open-btn">
                💬 댓글 달기
            </button>
        </section>
    </div>
</div>

<!-- 프리셋 추천 팝업 -->
<div id="preset-popup-container" class="hidden">
    <div class="preset-popup-content">
        <h3 data-lang-key="popup_preset_title">✨ 추천 스타일 프리셋</h3>
        <div class="preset-scroll-wrapper"></div>
        <button id="close-preset-popup-btn" class="preset-popup-close" title="닫기">&times;</button>
    </div>
</div>

<div id="comment-modal" class="comment-modal-overlay">

    <div id="modal-content" class="comment-modal-content">
        
        <span id="close-comment-modal" class="comment-close-btn">&times;</span>
        
        <h2 data-lang-key="COMMENT_MODAL_TITLE" class="comment-modal-title">💬 피드백 및 댓글</h2>
        
        <div class="comment-input-area">
            <h4 data-lang-key="COMMENT_SUBMIT_BUTTON" class="comment-input-title">새 댓글 등록</h4>
            
            <input type="text" id="nickname-input" class="comment-input-field" 
                   maxlength="20" data-lang-placeholder="COMMENT_INPUT_NICKNAME_PLACEHOLDER">
            
            <textarea id="comment-input" class="comment-input-field" 
                      rows="3" data-lang-placeholder="COMMENT_INPUT_CONTENT_PLACEHOLDER"></textarea>
            
            <button id="submit-comment" data-lang-key="COMMENT_SUBMIT_BUTTON" class="comment-submit-btn" style="float: right;">
                댓글 등록
            </button>
            <div style="clear: both;"></div>
        </div>

        <h3 data-lang-key="COMMENT_SECTION_TITLE" class="comment-section-title">전체 댓글</h3>
        
        <div id="comments-list" class="comments-list-container">
            </div>
        
    </div>
</div>

<!-- 모듈형 스크립트 로드 -->
<script type="module" src="js/App.js"></script>
<script src="js/comment.js"></script>


</body>
</html>